<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Neowana ê³µìœ </title>
  <script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
  <style>
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; margin: 24px }
    .hint { color:#666; font-size: 14px }
    #log { font-size: 13px; white-space: pre-wrap; color:#111; background:#f8fafc; border:1px solid #e5e7eb; border-radius:8px; padding:12px; margin-top:12px }
    #pick { margin-top: 12px; padding:10px 14px; border-radius:8px; background:#2563eb; color:#fff; border:0; }
    #magnetWrap { display:none; margin-top: 12px }
    a { word-break: break-all }
  </style>
</head>
<body>
  <h2>ğŸ§ Neowana ê³µìœ </h2>
  <p class="hint">íŒŒì¼ì„ ì„ íƒí•˜ë©´ ë¸Œë¼ìš°ì €ì—ì„œ ì‹œë”©ì„ ì‹œì‘í•˜ê³ , ë§ˆê·¸ë„· ë§í¬ë¥¼ ë§Œë“¤ì–´ ì•±ìœ¼ë¡œ ë³´ë‚´ì¤ë‹ˆë‹¤.</p>

  <input id="fileInput" type="file" accept="audio/*" style="display:none" />
  <button id="pick">íŒŒì¼ ì„ íƒ</button>

  <div id="magnetWrap">
    <p>ë§ˆê·¸ë„·: <a id="magnetLink" href="#" target="_blank"></a></p>
  </div>

  <div id="log"></div>

  <script>
    const client = new WebTorrent();
    const input = document.getElementById('fileInput');
    const pick  = document.getElementById('pick');
    const linkA = document.getElementById('magnetLink');
    const wrap  = document.getElementById('magnetWrap');
    const logEl = document.getElementById('log');

    function log(...args){ logEl.textContent += args.join(' ') + '\n'; }

    // RN WebView ìª½ì—ì„œ "íŒŒì¼ ì„ íƒ" ìš”ì²­ ë°›ì„ ìˆ˜ë„ ìˆìŒ (ì˜µì…˜)
    window.addEventListener('message', e => {
      try {
        const data = JSON.parse(e.data || '{}');
        if (data.type === 'OPEN_FILE_PICKER') input.click();
      } catch {}
    });

    pick.addEventListener('click', () => input.click());

    input.addEventListener('change', () => {
      const file = input.files && input.files[0];
      if (!file) return;

      log('ì‹œë”© ì‹œì‘:', file.name);
      const trackers = [
        'wss://tracker.openwebtorrent.com',
        'wss://tracker.btorrent.xyz',
        'wss://tracker.webtorrent.dev',
        'wss://tracker.files.fm:7073/announce'
      ];

      client.seed(file, { announce: trackers }, torrent => {
        const href = 'magnet:?xt=urn:btih:' + torrent.infoHash
          + '&dn=' + encodeURIComponent(file.name)
          + trackers.map(t => '&tr=' + encodeURIComponent(t)).join('');

        log('ë§ˆê·¸ë„· ìƒì„±:', href);
        wrap.style.display = 'block';
        linkA.href = href;
        linkA.textContent = href;

        // â˜… RN(WebView)ë¡œ ë§ˆê·¸ë„· ì „ì†¡
        if (window.ReactNativeWebView && window.ReactNativeWebView.postMessage) {
          window.ReactNativeWebView.postMessage(JSON.stringify({ type: 'MAGNET', href, name: file.name }));
          log('ì•±ìœ¼ë¡œ ë§ˆê·¸ë„· ì „ë‹¬ ì™„ë£Œ (postMessage).');
        } else {
          log('RN WebView ê°ì§€ ì•ˆë¨: ë¸Œë¼ìš°ì €ì—ì„œ í…ŒìŠ¤íŠ¸ ì¤‘ì¼ ê°€ëŠ¥ì„±.');
        }
      });
    });
  </script>
</body>
</html>
