<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Neowana 재생</title>
  <script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px}
    .hint{color:#666;font-size:14px}
  </style>
</head>
<body>
  <h2>🎧 Neowana 재생</h2>
  <p class="hint">이 페이지는 마그넷 링크로 스트리밍 재생을 시도합니다.</p>
  <p id="status">초기화 중…</p>
  <div id="player"></div>

  <script>
    const qs = new URLSearchParams(location.search);
    const magnet = qs.get('magnet');
    const status = document.getElementById('status');
    const player = document.getElementById('player');

    if (!magnet) {
      status.textContent = '마그넷 파라미터가 없습니다.';
    } else {
      status.textContent = '토렌트 메타데이터 가져오는 중…';
      const client = new WebTorrent();

      const trackers = [
        'wss://tracker.openwebtorrent.com',
        'wss://tracker.btorrent.xyz',
        'wss://tracker.webtorrent.dev'
      ];
      const href = magnet + trackers.map(t => '&tr=' + encodeURIComponent(t)).join('');

      client.add(href, torrent => {
        status.textContent = '파일 목록 로딩…';
        const file = torrent.files.find(f =>
          /\.(mp3|wav|m4a|aac|ogg)$/i.test(f.name)
        ) || torrent.files[0];

        if (!file) {
          status.textContent = '오디오 파일을 찾지 못했습니다.';
          return;
        }
        status.textContent = '스트리밍 시작: ' + file.name;
        file.appendTo(player, { autoplay: true, controls: true }, (err) => {
          if (err) {
            status.textContent = '플레이어 초기화 실패: ' + err.message;
          }
        });
      });
    }
  </script>
</body>
</html>
