<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Neowana ì¬ìƒ</title>
  <script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
  <style>
    :root { --pad: 16px; }
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      margin: 20px; color:#111;
    }
    .hint{ color:#666; font-size:14px; margin:4px 0 10px; }
    #status{ font-size:14px; margin:8px 0; }
    #player { position: sticky; top: 0; z-index: 2; background: #fff; padding-bottom: 8px; }
    audio { width: 100%; outline: none; }
    #log{
      font-size:13px; white-space:pre-wrap; color:#111;
      background:#f8fafc; border:1px solid #e5e7eb; border-radius:8px;
      padding:12px; margin-top:8px;
      max-height: 280px; overflow: auto;  /* ë¡œê·¸ ìƒì ë†’ì´ ì œí•œ */
    }
  </style>
</head>
<body>
  <h2>ğŸ§ Neowana ì¬ìƒ</h2>
  <p class="hint">ì´ í˜ì´ì§€ëŠ” ë§ˆê·¸ë„· ë§í¬ë¡œ ìŠ¤íŠ¸ë¦¬ë° ì¬ìƒì„ ì‹œë„í•©ë‹ˆë‹¤.<br/>ì‹œë”© ì¤‘ì¸ ê¸°ê¸°ì˜ ë¸Œë¼ìš°ì € íƒ­ì´ êº¼ì§€ë©´ ì¬ìƒì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤.</p>

  <div id="player"></div>
  <p id="status">ì´ˆê¸°í™” ì¤‘â€¦</p>
  <div id="log"></div>

  <script>
    const qs = new URLSearchParams(location.search);
    const magnet = qs.get('magnet');
    const statusEl = document.getElementById('status');
    const player = document.getElementById('player');
    const logEl   = document.getElementById('log');

    function log(...args){
      const line = args.join(' ');
      statusEl.textContent = line;
      logEl.textContent += line + '\n';
      logEl.scrollTop = logEl.scrollHeight;
    }

    if (!magnet) {
      log('ë§ˆê·¸ë„· íŒŒë¼ë¯¸í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
    } else {
      const client = new WebTorrent();
      const trackers = [
        'wss://tracker.openwebtorrent.com',
        'wss://tracker.btorrent.xyz',
        'wss://tracker.webtorrent.dev',
        'wss://tracker.files.fm:7073/announce',
        'wss://spacetradersapi-chatbox.uno:443/announce',
      ];
      const href = magnet + trackers.map(t => '&tr=' + encodeURIComponent(t)).join('');
      log('í† ë ŒíŠ¸ ë©”íƒ€ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘â€¦ (íŠ¸ë˜ì»¤ ì—°ê²° ì‹œë„)');

      client.on('error', e => log('CLIENT ERROR:', e.message));

      client.add(href, torrent => {
        log('í† ë ŒíŠ¸ ì¶”ê°€ ì™„ë£Œ. infoHash =', torrent.infoHash);

        const iv = setInterval(() => {
          log(`í”¼ì–´: ${torrent.numPeers} | ë°›ì€: ${(torrent.downloaded/1024/1024).toFixed(2)}MB | ì†ë„: ${(torrent.downloadSpeed/1024).toFixed(0)}KB/s`);
        }, 1000);
        torrent.on('wire', () => log('í”¼ì–´ ì—°ê²°ë¨. í˜„ì¬ í”¼ì–´:', torrent.numPeers));
        torrent.on('noPeers', a => log('í”¼ì–´ ì—†ìŒ ìœ í˜•:', a || 'unknown'));
        torrent.on('error', e => log('TORRENT ERROR:', e.message));

        const file = torrent.files.find(f => /\.(mp3|wav|m4a|aac|ogg)$/i.test(f.name)) || torrent.files[0];
        if (!file) { clearInterval(iv); log('ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'); return; }

        log('ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘:', file.name);
        file.appendTo(player, { autoplay: true, controls: true }, err => {
          if (err) log('í”Œë ˆì´ì–´ ì´ˆê¸°í™” ì‹¤íŒ¨:', err.message);
        });
      });
    }
  </script>
</body>
</html>
